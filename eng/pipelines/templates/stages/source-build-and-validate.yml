parameters:
- name: centOSStreamContainerName
  type: string
  default: centOSStreamContainer

- name: centOSStreamContainerImage
  type: string
  default: mcr.microsoft.com/dotnet-buildtools/prereqs:centos-stream-10-amd64

- name: centOSStreamX64Rid
  type: string
  default: centos.10-x64

- name: legs
  type: object

stages:
- stage: VMR_SourceOnly_Build
  displayName: VMR Source-Only Build
  dependsOn: []
  jobs:
  - ${{ each leg in parameters.legs }}:
    - template: ../jobs/vmr-build.yml
      parameters:
        # CentOS
        ${{ if eq(leg.distro, 'centos') }}:
          buildName: ${{ format(leg.buildNameFormat, parameters.centOSStreamName) }}
          container:
            name: ${{ parameters.centOSStreamContainerName }}
            image: ${{ parameters.centOSStreamContainerImage }}
          ${{ if ne(leg.reuseBuildArtifactsFrom, '') }}:
            reuseBuildArtifactsFrom:
            - ${{ format(leg.reuseBuildArtifactsFrom, variables.centOSStreamName) }}
          ${{ if and(contains(leg.buildNameFormat, 'Previous'), eq(leg.targetArchitecture, 'x64')) }}:
            artifactsRid: ${{ parameters.centOSStreamX64Rid }}
        
        targetArchitecture: ${{ leg.targetArchitecture }}
        isBuiltFromVmr: true
        buildSourceOnly: true
        runTests : false
        enablePoison: ${{ leg.enablePoison }}
        buildFromArchive: ${{ leg.buildFromArchive }}
        runOnline: ${{ leg.runOnline }}
        useMonoRuntime: ${{ leg.useMonoRuntime }}
        withPreviousSDK: ${{ leg.withPreviousSDK }}
